{{ define "request-monitor" }}

{{ if .Requests.TracingEnabled }}
<!-- Page level plugins -->
<script src="/function/faas-flow-dashboard/static/vendor/chart.js/Chart.min.js"></script>

<!-- Page level custom scripts -->
<script src="/function/faas-flow-dashboard/static/js/demo/chart-area-demo.js"></script>
<script src="/function/faas-flow-dashboard/static/js/demo/chart-pie-demo.js"></script>

<!-- google charts -->
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
{{ end }}

<!-- Content Row -->
<div class="row">
    <div class="card border border-grey shadow shadow-sm h-100 py-2" style="width: 70vw;">
        {{ if .Requests.TracingEnabled }}
		<div id="canvas" style="width: 100%; height: 30vw;">
            <!-- Traces goes here -->
        </div>
        <div class="card-body bg-light">
            <h2 id="request-id" class="card-title">Request ID: {{ .Traces.RequestID }}</h2>
        </div>
        <ul class="list-group list-group-flush">
            <li class="list-group-item" id="start-time">Start Time: {{ .Traces.StartTime }}</li>
            <li class="list-group-item" id="exec-duration">Duration: {{ .Traces.Duration }}</li>
		    <li class="list-group-item" id="exec-status">State: {{ .Traces.Status }} </li>
        </ul>
        <div class="card-body">
           <a id="refresh-traces" href="#"
              class="card-link btn btn-info" data-toggle="tooltip" title="Click to refresh request traces">
               <i class="fa fa-sync-alt"></i>
		       Refresh
		   </a>
           <a id="stop-request" href="#"
               class="card-link btn btn-danger" data-toggle="tooltip" title="Click to stop the request">
               <i class="fa fa-stop"></i>
               Stop
           </a>
           <a id="pause-request" href="#"
               class="card-link btn btn-warning" data-toggle="tooltip" title="Click to pause the request">
               <i class="fa fa-pause"></i>
               Pause
           </a>
           <a id="resume-request" href="#"
               class="card-link btn btn-success" data-toggle="tooltip" title="Click to resume the request">
               <i class="fa fa-play"></i>
               Resume
           </a>
           <a id="download-trace-logs" href="#"
              class="card-link btn btn-secondary" data-toggle="tooltip" title="Click to download raw trace logs">
               <i class="fa fa-download"></i>
		       Logs
		   </a>
        </div>
        {{ end }}
        {{ if not .Requests.TracingEnabled }}
            <div class="card-body">
                <h5 class="card-title">How to make your flow requests visible?</h5>
                <p>
                    FaaSFlow monitoring provides execution status of individual requests and traces in the UI.
                    In order to monitor flow function, tracing data must be stored in trace server.
                    FaaSFlow uses jaeger as a tracing backend
                </p>
                <p>
                    For flow function enable tracing <code>enable_tracing: true</code>
                    and set trace server url <code>trace_server: "jaegertracing:5775"</code>
                </p>
                <p>
                    Provide the same trace server API url <code>trace_url: "jaegertracing:16686"</code>
                    in <code>conf.yml</code>
                </p>
                <a href="https://github.com/s8sg/faas-flow-tower/blob/master/README.md" class="btn btn-secondary">Learn More</a>
            </div>
        {{ end }}
    </div>
</div>

{{ end }}
